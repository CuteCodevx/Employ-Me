<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="180">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
    <link rel="stylesheet" href="/stylesheets/companyAccount.css">
    <script type="text/javascript" src="/javascripts/jquery-3.3.1.min.js"></script>
    <title>Company Account</title>
</head>
<body class="w3-content">

<%include header.ejs%>
<!--Received applications-->
    <div class="w3-container" id="received">
        <h3 class="w3-padding-32" id="title1"><strong>Received Application</strong></h3>
        <%if(received.length > 0){
        for(var i=0;i<received.length;i++){%>
        <div class="w3-panel w3-container w3-border w3-border-gray w3-round-xlarge">
            <div class="w3-row">
                <div class="w3-col m4">
                    <p><%=received[i].date%></p>
                </div>
                <div class="w3-col m4">
                    <p><span class="InviteJob"><%=received[i].career%></span> From <span class="applicant"><%=received[i].employeeAccount%></span></p>
                </div>
                <div class="w3-col m4">
                    <p class="w3-right"><a class="checkEmployee" href="">Check Applicant</a></p>
                </div>
            </div>
        </div>
        <%}}else{%>
        <p class="w3-center">You haven't received any application</p>
        <%}%>
    </div>


<!--Public new publication model-->
<section id="publicJob" class="w3-modal">
    <div class="w3-modal-content w3-animate-top w3-card-4">
        <header class="w3-container w3-black w3-center w3-padding-32">
        <span onclick="document.getElementById('publicJob').style.display='none'"
              class="w3-button w3-black w3-xlarge w3-display-topright">X</span>
            <h2 class="w3-wide">Public New Job</h2>
        </header>
        <form enctype="multipart/form-data" class="w3-container w3-card-4" id="postForm" onsubmit="return false">
            <p>
                <label>Name of Company  </label> <span class="w3-large" id="companyName"><%=nameCompany%></span>
            </p>
            <p>
                <label>Occupation</label>
                <input class="w3-input" type="text" name="career" required id="career">
            </p>
            <label>Address</label>
            <p id="locationField" class="w3-section">
                <input class="w3-input"
                       id="autocomplete"
                       placeholder="Enter your address"
                       onFocus="geolocate()"
                       type="text"/>
            </p>
            <table id="address" class="w3-table w3-padding-32 w3-margin">
                <tr>
                    <td class="label">Street address</td>
                    <td class="slimField"><input class="field" id="street_number" disabled="true"/></td>
                    <td class="wideField" colspan="2"><input class="field" id="route" disabled="true"/></td>
                </tr>
                <tr>
                    <td class="label">City</td>
                    <td class="wideField" colspan="3"><input class="field" id="locality" disabled="true"/></td>
                </tr>
                <tr>
                    <td class="label">State</td>
                    <td class="slimField"><input class="field" id="administrative_area_level_1" disabled="true"/></td>
                    <td class="label">Zip code</td>
                    <td class="wideField"><input class="field" id="postal_code" disabled="true"/></td>
                </tr>
                <tr>
                    <td class="label">Country</td>
                    <td class="wideField" colspan="3"><input class="field" id="country" disabled="true"/></td>
                </tr>
            </table>

            <p>
                <label>Rate of Pay (Pounds/Year)</label>
                <input class="w3-input" type="text" name="pay" required id="pay">
            </p>
            <p>
                <label>Occupation description</label>
                <textarea class="w3-input" type="text" name="description" required id="desc"></textarea>
            </p>

            <p>
                <label>Occupation requirement</label>
                <textarea class="w3-input" type="text" name="requirement" required id="requ"></textarea>
            </p>

            <p><label>Job Type</label>
                <select class="w3-section w3-select w3-border" name="option" id="first" onChange="change()">
                    <option value="">Software</option>
                    <option value="">Finance</option>
                    <option value="">Biology</option>
                    <option value="">Arts</option>
                    <option value="">Literature</option>
                </select>

                <select class=" w3-select w3-border" id="second">

                </select>
            </p>

            <p>
                <label for="file">File input:</label>
                <input type="file" name="file" id="file">
            </p>

            <button type="submit" class="w3-button w3-block w3-black w3-padding-16 w3-section w3-right">SUBMIT <i class="fa fa-check"></i></button>

        </form>
    </div>
</section>

<!--Previous publication-->
<div class="w3-container" id="previous">
    <h3 class="w3-padding-32"><strong>Previous Publication</strong></h3>
    <!--public new occupation-->
    <div class="w3-container w3-center w3-margin w3-padding-32" id="new">
        <a><button class="w3-button w3-black w3-round-xlarge" id="public">Post a New Job</button></a>
    </div>
    <%if(public.length>0){
    for(var i=0;i<public.length;i++){ %>
    <div class="w3-panel w3-container w3-border w3-border-gray w3-round-xlarge">
        <div class="w3-row">
            <div class="w3-col m4">
                <p><%=public[i].date%></p>
            </div>
            <div class="w3-col m4">
                <p>I publicized a job <span class="career w3-large"><%=public[i].career%></span></p>
            </div>
            <div class="w3-col m4">
                <p class="w3-right"><a style="cursor: pointer" class="checkPublic">Check</a> / <a style="cursor: pointer" class="delete">Delete</a> </p>
            </div>
        </div>
    </div>
    <%}}else{%>
    <p class="w3-center">You haven't public any job information.</p>
    <%}%>
</div>


<!--My invitation-->

<div class="w3-container" style="margin-top: 2%">
    <h3 class="w3-padding-32"><strong>My Invitation Records</strong></h3>
    <%if(invite.length>0){
    for(var i=0;i<invite.length;i++){ %>
    <div class="w3-panel w3-container w3-border w3-border-gray w3-round-xlarge">
        <div class="w3-row">
            <div class="w3-col m4">
                <p><%=invite[i].date%></p>
            </div>
            <div class="w3-col m4">
                <p>I invited <span class="recordCandidate"><%=invite[i].employee%></span> to interview <span class="recordJob"><%=invite[i].job%></span></p>
            </div>
            <div class="w3-col m4">
                <p class="w3-right"><a class="checkInvite" href="">Check</a> </p>
            </div>
        </div>
    </div>
    <%}}else{%>
    <p class="center">You haven't invite any people.</p>
    <%}%>
</div>




<%include footer.ejs%>

<script>
    function change() {
        var x = document.getElementById("first");
        var y = document.getElementById("second");
        y.options.length = 0;
        if(x.selectedIndex == 0)
        {
            y.options.add(new Option("Java Development", "0"));
            y.options.add(new Option("PHP Development", "1", false, true));
            y.options.add(new Option("Web Development", "2"));
            y.options.add(new Option("Python Development", "3"));
            y.options.add(new Option("Database Development", "4"));
            y.options.add(new Option("AI Development", "5"));
            y.options.add(new Option("None", "6"));
        }

        if(x.selectedIndex == 1)
        {
            y.options.add(new Option("Bank", "0"));
            y.options.add(new Option("Marketing", "1", false, true));
            y.options.add(new Option("Securities", "2"));
            y.options.add(new Option("Stock", "3"));
            y.options.add(new Option("Insurance", "4"));
            y.options.add(new Option("The credit", "5"));
            y.options.add(new Option("None", "6"));
        }

        if(x.selectedIndex == 2)
        {
            y.options.add(new Option("Biology engineer", "0"));
            y.options.add(new Option("Biology assistant", "1", false, true));
            y.options.add(new Option("Biology education", "2"));
            y.options.add(new Option("None", "3"));
        }

        if(x.selectedIndex == 3)
        {
            y.options.add(new Option("The fine arts", "0"));
            y.options.add(new Option("Music arts", "1", false, true));
            y.options.add(new Option("Arts education", "2"));
            y.options.add(new Option("None", "3"));
        }

        if(x.selectedIndex == 4)
        {
            y.options.add(new Option("English literature", "0"));
            y.options.add(new Option("Foreign literature", "1", false, true));  // 默认选中省会城市
            y.options.add(new Option("Literature education", "2"));
            y.options.add(new Option("None", "3"));
        }
    }
    //autocomplete address form
    var placeSearch, autocomplete;

    var componentForm = {
        street_number: 'short_name',
        route: 'long_name',
        locality: 'long_name',
        administrative_area_level_1: 'short_name',
        country: 'long_name',
        postal_code: 'short_name'
    };

    function initAutocomplete() {
        // Create the autocomplete object, restricting the search predictions to
        // geographical location types.
        autocomplete = new google.maps.places.Autocomplete(
            document.getElementById('autocomplete'), {types: ['geocode']});

        // Avoid paying for data that you don't need by restricting the set of
        // place fields that are returned to just the address components.
        autocomplete.setFields(['address_component']);

        // When the user selects an address from the drop-down, populate the
        // address fields in the form.
        autocomplete.addListener('place_changed', fillInAddress);
    }

    function fillInAddress() {
        // Get the place details from the autocomplete object.
        var place = autocomplete.getPlace();

        for (var component in componentForm) {
            document.getElementById(component).value = '';
            document.getElementById(component).disabled = false;
        }

        // Get each component of the address from the place details,
        // and then fill-in the corresponding field on the form.
        for (var i = 0; i < place.address_components.length; i++) {
            var addressType = place.address_components[i].types[0];
            if (componentForm[addressType]) {
                var val = place.address_components[i][componentForm[addressType]];
                document.getElementById(addressType).value = val;
            }
        }
    }

    // Bias the autocomplete object to the user's geographical location,
    // as supplied by the browser's 'navigator.geolocation' object.
    function geolocate() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var geolocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                var circle = new google.maps.Circle(
                    {center: geolocation, radius: position.coords.accuracy});
                autocomplete.setBounds(circle.getBounds());
            });
        }
    }
    $(function () {

        $('#public').click(function () {
            $('#publicJob').css("display","block");
        })
        
        //check publication
        $('.checkPublic').each(function (index,ele) {
            $(this).click(function () {
                var name = $('#companyAccount').text();
                var career= $('.career')[index].innerHTML;
                career=career.trim();
                name=name.trim();
                location.href='/careerdetail?name='+name+'&career='+career+'';
            })
        })

        //check employee information
        $('.checkEmployee').each(function (i,ele) {
            $(this).click(function () {
                var name = $('.applicant')[i].innerHTML;
                name=name.trim();
                $(this).attr('href','/users/userdetail?username='+name+'');
            })
        })
        $('.checkInvite').each(function (i,ele) {
            $(this).click(function () {
                var career = $('.recordJob')[i].innerHTML;
                var name = $('.recordCandidate')[i].innerHTML;
                career=career.trim();
                name=name.trim();
                $(this).attr('href',"/candidatedetail?name="+name+"&career="+career+"");
            })
        })

        //post new job
        $('#postForm').submit(function () {
            var account = $('#companyAccount').text();
            var name = $('#companyName').text();
            var career = $('#career').val();
            var pay = $('#pay').val();
            var desc=$('#desc').val();
            var requ = $('#requ').val();
            var date= new Date();
            var type=[$('#first').find("option:selected").text(),$('#second').find("option:selected").text()];
            //address
            var streetAddress = $('#street_number').val()+', '+$('#route').val();
            var postcode = $('#postal_code').val();
            var city = $('#locality').val();
            var state=$('#administrative_area_level_1').val();
            var country = $('#country').val();
            //upload file
            var file=$('#file')[0];

            var formData = new FormData();
            formData.append('file',file.files[0]);
            formData.append('name',name);
            formData.append('career',career);
            formData.append('city',city);
            formData.append('pay',pay);
            formData.append('description',desc);
            formData.append('requ',requ);
            formData.append('date',date.toLocaleString());
            formData.append('type',type);
            formData.append('account',account);
            formData.append('streetAddress',streetAddress);
            formData.append('postcode',postcode);
            formData.append('state',state);
            formData.append('country',country);

            $.ajax({
                url:'/company/companyAccount',
                type:'post',
                contentType: false,
                processData: false,
                data:formData,
                success:function (res) {
                    alert('post success');
                    //back the current page
                    location.href="/company/companyAccount?username="+account+"";
                },
                error:function (err) {
                    console.log(err);
                }

            })
        })

        //delete application
        $('.delete').each(function (index,ele) {
            $(this).click(function () {
                var username = $('#companyAccount').text();
                var name = $('#companyName').text();
                var career= $('.career')[index].innerHTML;
                career=career.trim();
                username=username.trim();
                name=name.trim();
                var data={username:username,name:name,career:career};
                $.ajax({
                    url:'/company/deletePublication',
                    type:'post',
                    data:data,
                    success:function (data) {
                        alert('delete success');
                        //back the current page
                        location.href="/company/companyAccount?username="+username+"";
                    },
                    error:function (err) {
                        console.log(err)
                    }
                })

            })
        })
    })


</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBCRdAXwaZD4Gc302lr8jSVOSQ8z28bOlo&libraries=places&callback=initAutocomplete"
        async defer></script>
</body>
</html>