<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="180">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="/stylesheets/careerdetail.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="/javascripts/jquery-3.3.1.min.js"></script>
    <title>Candidate</title>
</head>
<body class="w3-content">
<% include header.ejs%>

<div class="w3-container w3-margin-top" id="title">
    <div class="w3-padding-32 w3-xlarge w3-black">
        <i class="fa fa-home"></i>
        Candidate Details
    </div>
</div>
<!--candidate detail-->
<div class="w3-container" id="panel">
    <div class="w3-container w3-panel w3-light-grey w3-border w3-round">
        <label><strong>Username</strong></label>
        <p id="employeeUsername"> <%=detail.username%></p>
    </div>

    <div class="w3-container w3-panel w3-light-grey w3-border w3-round">
        <label><strong>Name</strong></label>
        <p id="employeeName"><%=detail.firstName%> <%=detail.lastName%></p>
    </div>

    <div class="w3-container w3-panel w3-light-grey w3-border w3-round">
        <label><strong>Target Job</strong></label>
        <p id="career"><%=job%></p>
    </div>

    <div class="w3-container w3-panel w3-light-grey w3-border w3-round">
        <label><strong>Target City</strong></label>
        <p><%=city%></p>
    </div>

    <div class="w3-container w3-panel w3-light-grey w3-border w3-round">
        <label><strong>Introduction: </strong></label>
        <p><%=intro%></p>
    </div>

    <div class="w3-container w3-panel w3-light-grey w3-border w3-round">
        <label><strong>Degree Level:</strong></label>
        <p><%=detail.degreeLevel%></p>
    </div>
    <div class="w3-container w3-panel w3-light-grey w3-border w3-round">
        <label><strong>Major:</strong></label>
        <p><%=detail.major%></p>
    </div>

    <div class="w3-container w3-panel w3-light-grey w3-border w3-round">
        <label><strong>Tel:</strong></label>
        <p><%=detail.phoneNumber%></p>
    </div>
    <div class="w3-container w3-panel w3-light-grey w3-border w3-round">
        <label><strong>Email:</strong></label>
        <p><%=detail.email%></p>
    </div>

</div>

<div class="w3-container" id="button">
    <button class="w3-btn w3-round-large w3-black " id="invite">Invite</button>
</div>

<!--comment model-->
<section id="reviewModal" class="w3-modal">
    <div class="w3-modal-content w3-animate-top w3-card-4">
        <header class="w3-container w3-black w3-center w3-padding-32">
        <span onclick="document.getElementById('reviewModal').style.display='none'"
              class="w3-button w3-black w3-xlarge w3-display-topright">X</span>
            <h2 class="w3-wide">Review</h2>
        </header>
        <form enctype="multipart/form-data" class="w3-container" id="comment" onsubmit="return false">
            <p><label for="content">Share your feeling</label></p>
            <input class="w3-input w3-border" type="text" required name="content" id="content">
            <p><label for="score">How much point will you give this candidate</label> <b class="w3-small">(The point is no more than 5)</b></p>
            <input class="w3-input w3-border" type="number" required name="score" id="score">
            <p><label for="realName">Please input the company name</label></p>
            <input class="w3-input w3-border" type="text" required name="realName" id="realName">
            <p>
                <label for="file">File input:</label>
                <input type="file" name="file" id="file">
            </p>
            <button type="submit" class="w3-button w3-block w3-black w3-padding-16 w3-section w3-right">SUBMIT <i class="fa fa-check"></i></button>
        </form>
    </div>
</section>

<!--show information about candidate-->
<section class="w3-container w3-card" style="margin-top:64px">
    <!--show average scores-->
    <div class="w3-container  w3-center">
        <h3 style="margin-top: 48px">AVERAGE SCORE</h3>
        <br><br>
        <span class="w3-tag w3-xlarge" id="aveScore"><%=detail.aveScore%></span>
    </div>
    <!--show comments-->
    <div class="w3-container ">
        <h3 class="w3-center" style="margin:48px">REVIEWS</h3>
        <%if(comment.length>0){
        for(var i=0;i<comment.length;i++){%>
        <div class="w3-card-4 w3-white w3-section">
            <div class="w3-container">
                <h5><a href="/company/companydetail?username=<%=comment[i].evaluators%>"><b><%=comment[i].evaluators%></b></a><span class="w3-opacity w3-right w3-small"><i class="w3-text-black">Reviewed</i> <%=comment[i].date%></span></h5>
            </div>
            <div class="w3-container">
                <p class="w3-text-red"><%=comment[i].score%></p>
                <p><%=comment[i].comments%></p>
            </div>
            <%if(comment[i].path){%>
            <div class="w3-container w3-panel w3-round">
                <img class="w3-round w3-image" src="/images/<%=comment[i].path%>" style="width:100%;max-width:400px" alt="">
            </div>
            <%}%>
        </div>
        <%}}else{%>
        <p class="w3-center">There are currently no reviews.</p>
        <%}%>
        <button class="w3-btn w3-round-large w3-margin w3-black w3-right" id="evaluate">Comment</button>
    </div>
</section>
<%include footer.ejs%>
<script>
    $(function () {
        var companyaccount= $('#companyAccount').text();
        var career = $('#career').text();
        var username=$('#employeeUsername').text();
        var name=$('#employeeName').text();

        $('#invite').click(function () {

            if(!companyaccount){
                alert('Please login to your account first!');
            }else{

                var date = new Date();
                var data = {'employee':username,'employer':companyaccount,'date':date.toLocaleString(),'job':career};

                $.ajax({
                    url:'/candidatedetail',
                    type:'post',
                    data:data,
                    success:function (result) {
                        //console.log(result);
                        alert('invite successfully!');
                        location.href='candidatedetail?name='+name+'&career='+career+'';
                    },
                    error:function (err,result) {
                        // console.log(err.statusText);
                        alert("You have already invited this person!");
                    }
                })


            }
        })
        $('#evaluate').click(function () {

            var date = new Date();

            if(!companyaccount){
                alert('Please Login to your account first!');
            }else{
                $('#reviewModal').css('display','block');

                $('#comment').submit(function () {
                    //get review
                    var evaluator=$('#realName').val();
                    var score = $('#score').val();
                    var content=$('#content').val();

                    //upload file
                    var file=$('#file')[0];

                    var formData = new FormData();
                    formData.append('file',file.files[0]);
                    formData.append('username',username.trim());
                    formData.append('name',name.trim());
                    formData.append('score',score);
                    formData.append('realName',evaluator.trim());
                    formData.append('content',content);
                    formData.append('date',date.toLocaleString());
                    console.log(formData);
                    //var data={username:username,name:name,realName:evaluator,score:score,content:content,date:date.toLocaleString()};
                    $.ajax({
                        url:'comment',
                        type:'post',
                        contentType: false,
                        processData: false,
                        data:formData,
                        success:function (result) {
                            alert('review successfully!');
                            location.href='candidatedetail?name='+name+'&career='+career+'';
                        },
                        error:function (err) {
                            alert(err);
                        }
                    })
                })
            }

        })

    })
</script>
</body>
</html>